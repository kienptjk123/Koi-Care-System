import{d as xt,r as i,u as pt,a as h,j as t,m as l,B as z}from"./index-Qtd3etr3.js";import{L as mt,H as ut}from"./LeftSideBar-FT7tCOUc.js";import{T as ft}from"./TopLayout-DUOKeQ7A.js";import{R as g,C as x,X as p,Y as m,T as u,L as j,B as jt,a as yt}from"./BarChart-DmEqc4zR.js";import{L as b,a as f}from"./LineChart-BAh0fStb.js";import{A as H,a as y}from"./AreaChart-DPKWJGj-.js";import"./index-BuglD1Vv.js";import"./index-DF6yzlP_.js";import"./index-CYe7FaXN.js";import"./index-CdZqjTQo.js";/* empty css            */import"./logo-DG-ZgLhE.js";import"./Typography-Ccp8Yzjl.js";import"./isEqual-BKDIiBm5.js";function Mt(){const{isDarkMode:K}=xt(),[W,P]=i.useState([]),[w,V]=i.useState([]),[O,R]=i.useState([]),[U,Y]=i.useState([]),[X,q]=i.useState([]),[E,I]=i.useState(null),M=pt(),[wt,F]=i.useState(null),[k,J]=i.useState("Day"),[kt,Q]=i.useState([]),[B,Z]=i.useState([]),[d,L]=i.useState({nitrite:1,nitrate:1,phosphate:1,ammonium:1,oxygen:1,carbonHardness:1,phValue:1,hardness:1,totalChlorine:1,carbonDioxide:1,temperature:1,temp:1,amountFed:1});let v=[...["#B22222","#228B22","#00008B","#FFD700","#8B008B","#008B8B","#2F4F4F","#8B0000","#556B2F","#006400","#4B0082","#483D8B","#FF4500","#A52A2A","#DC143C","#8B4513","#4682B4","#D2691E","#9932CC","#191970"]];const _=o=>{const a=o.target.value,e=w.find(s=>s.id===parseInt(a));e?(F(e),T(a),$(a)):F(null)};i.useEffect(()=>{w.length===1&&F(w[0])},[w]);const tt=async()=>{var o,a;try{const e=localStorage.getItem("token"),s=localStorage.getItem("id");if(!e)throw new Error("No token found");const r=await h.get(`https://koicaresystemv2.azurewebsites.net/api/koiponds/user/${s}/koiponds`,{headers:{Authorization:`Bearer ${e}`}});V(r.data.data)}catch(e){h.isAxiosError(e)?((o=e.response)==null?void 0:o.status)===401?(console.error("Unauthorized access - Token expired or invalid. Logging out..."),localStorage.removeItem("token"),localStorage.removeItem("id"),z.error("Token expired navigate to login"),M("/login")):console.error("Error fetching ponds:",(a=e.response)==null?void 0:a.status,e.message):console.error("An unexpected error occurred:",e)}};i.useEffect(()=>{tt()},[]);const T=async o=>{try{const a=localStorage.getItem("token"),e=await h.get(`https://koicaresystemv2.azurewebsites.net/api/water-parameters/getByKoiPondId/${o}`,{headers:{Authorization:`Bearer ${a}`}});P(e.data.data)}catch(a){console.log(a)}};i.useEffect(()=>{T()},[]);const et=async()=>{try{const o=localStorage.getItem("token"),a=localStorage.getItem("id");if(!o)throw new Error("No token found");const e=await h.get(`https://koicaresystemv2.azurewebsites.net/api/koifishs/user/${a}/allKoi`,{headers:{Authorization:`Bearer ${o}`}});R(e.data.data)}catch(o){console.error("Error fetching koi:",o)}};i.useEffect(()=>{et()},[]);const $=async o=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");const s=(await h.get(`https://koicaresystemv2.azurewebsites.net/api/koifishs/koipond/${o}/allKoi`,{headers:{Authorization:`Bearer ${a}`}})).data.data;Q(s);const r=s.map(n=>h.get(`https://koicaresystemv2.azurewebsites.net/api/growth-history/list/${n.id}`,{headers:{Authorization:`Bearer ${a}`}}).then(gt=>({koiName:n.name,growthData:gt.data.data}))),c=await Promise.all(r);Z(c)}catch(a){console.error("Error fetching koi or growth history by pond:",a)}};i.useEffect(()=>{$()},[]);const at=async o=>{var a,e;try{const s=localStorage.getItem("token");if(!s)throw new Error("No token found");const r=await h.get(`https://koicaresystemv2.azurewebsites.net/api/growth-history/list/${o}`,{headers:{Authorization:`Bearer ${s}`}});Y(r.data.data)}catch(s){h.isAxiosError(s)?((a=s.response)==null?void 0:a.status)===401?(console.error("Unauthorized access - Token expired or invalid. Logging out..."),localStorage.removeItem("token"),localStorage.removeItem("id"),z.error("Token expired navigate to login"),M("/login")):console.error("Error fetching growth history:",(e=s.response)==null?void 0:e.status,s.message):console.error("An unexpected error occurred:",s)}};i.useEffect(()=>{E&&(at(E.id),st(E.id))},[E]);const ot=o=>{const a=o.target.value,e=O.find(s=>s.id===parseInt(a));I(e||null)},st=async o=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");const e=await h.get(`https://koicaresystemv2.azurewebsites.net/api/reports/GrowthFish/${o}`,{headers:{Authorization:`Bearer ${a}`}});console.log("koi history",e.data.data);const s=e.data.data.slice(1);q(s)}catch(a){console.error("Error fetching koi history:",a)}},D=i.useCallback(o=>{const{dataKey:a}=o;L({...d,[a]:.5})},[d,L]),C=i.useCallback(o=>{const{dataKey:a}=o;L({...d,[a]:1})},[d,L]),A=o=>{const a=new Date(o);if(k==="Day")return a.toLocaleString();if(k==="Last month")return a.toLocaleDateString("en-US",{month:"long",year:"numeric"});if(k==="Last year")return a.getFullYear()},rt=(o,a)=>{const e={};return o.forEach(s=>{const r=A(s.createDate);e[r]||(e[r]={name:r,length:0,weight:0,count:0,lengthStandard:0,weightStandard:0}),e[r].length+=s.length,e[r].weight+=s.weight,e[r].count+=1}),a.forEach(s=>{const r=A(s.createDate);e[r]||(e[r]={name:r,length:0,weight:0,count:0,lengthStandard:0,weightStandard:0}),e[r].lengthStandard=s.length,e[r].weightStandard=s.weight}),Object.values(e).map(s=>({name:s.name,length:s.length/s.count,weight:s.weight/s.count,lengthStandard:s.lengthStandard,weightStandard:s.weightStandard}))},it=o=>{const a={};return o.forEach(e=>{const s=A(e.createDateTime);a[s]||(a[s]={name:s,nitrite:0,nitrate:0,phosphate:0,carbonHardness:0,phValue:0,hardness:0,count:0,totalChlorine:0,oxygen:0,carbonDioxide:0,temperature:0,temp:0,amountFed:0}),a[s].nitrite+=e.nitrite,a[s].nitrate+=e.nitrate,a[s].oxygen+=e.oxygen,a[s].carbonDioxide+=e.carbonDioxide,a[s].totalChlorine+=e.totalChlorine,a[s].phosphate+=e.phosphate,a[s].carbonHardness+=e.carbonHardness,a[s].phValue+=e.phValue,a[s].hardness+=e.hardness,a[s].temp+=e.temp,a[s].temperature+=e.temperature,a[s].amountFed+=e.amountFed,a[s].count+=1}),Object.values(a).map(e=>({name:e.name,nitrite:e.nitrite/e.count,nitrate:e.nitrate/e.count,phosphate:e.phosphate/e.count,carbonHardness:e.carbonHardness/e.count,phValue:e.phValue/e.count,hardness:e.hardness/e.count,totalChlorine:e.totalChlorine/e.count,oxygen:e.oxygen/e.count,carbonDioxide:e.carbonDioxide/e.count,temperature:e.temperature/e.count,temp:e.temp/e.count,amountFed:e.amountFed/e.count}))},nt=o=>{J(o.target.value)},S=it([...W].sort((o,a)=>new Date(o.createDateTime)-new Date(a.createDateTime))),G=rt([...U].sort((o,a)=>new Date(o.createDate)-new Date(a.createDate)),X),N=o=>o&&o.toFixed(2),lt=o=>{const a=new Date(o);if(k==="Day")return a.toLocaleDateString();if(k==="Last month")return a.toLocaleDateString("en-US",{month:"long",year:"numeric"});if(k==="Last year")return a.getFullYear()},dt=()=>{const o={},a={};B.forEach(r=>{r.growthData.forEach(c=>{const n=lt(c.createDate);o[n]||(o[n]={date:n,lengthTotal:0,count:0}),a[n]||(a[n]={date:n,weightTotal:0,count:0}),o[n].lengthTotal+=c.length,a[n].weightTotal+=c.weight,o[n].count+=1,a[n].count+=1,o[n][r.koiName]=c.length,a[n][r.koiName]=c.weight})});const e=Object.values(o).map(r=>({date:r.date,avgLength:r.lengthTotal/r.count,...r})).sort((r,c)=>new Date(r.date)-new Date(c.date)),s=Object.values(a).map(r=>({date:r.date,avgWeight:r.weightTotal/r.count,...r})).sort((r,c)=>new Date(r.date)-new Date(c.date));return{lengthChartData:e,weightChartData:s}},{lengthChartData:ct,weightChartData:ht}=dt();return t.jsx("div",{children:t.jsxs("div",{className:"h-screen flex",children:[t.jsx(mt,{}),t.jsxs("div",{className:`relative ${K?"bg-custom-dark text-white":"bg-white text-black"} shadow-xl flex-1 flex-col overflow-y-auto overflow-x-hidden`,children:[t.jsx(ut,{}),t.jsxs("div",{className:"py-5 px-[30px] mx-auto max-w-[2000px]",children:[t.jsx(ft,{text:"Statistics",links:"member/statistics"}),t.jsxs("div",{className:"pb-6 lg:text-lg text-sm flex justify-between items-center",children:[t.jsxs("select",{id:"ponds",className:`${K?"bg-custom-dark":""} border rounded-lg p-2 outline-none`,onChange:_,children:[t.jsx("option",{value:"",children:"Select a pond"}),w.length>0?w.map(o=>t.jsx("option",{value:o.id,children:o.name},o.id)):t.jsx("option",{disabled:!0,children:"Loading ponds..."})]}),t.jsxs("select",{onChange:nt,className:`${K?"bg-custom-dark":""} border rounded-lg p-2 outline-none`,children:[t.jsx("option",{value:"Day",children:"Day"}),t.jsx("option",{value:"Last month",children:"Last month"}),t.jsx("option",{value:"Last year",children:"Last year"})]})]}),t.jsxs(l.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.3}}},className:"grid lg:grid-cols-3 md:grid-cols-2 grid-cols-1 gap-7",children:[t.jsxs(l.div,{variants:{hidden:{opacity:0,x:100},visible:{opacity:1,x:0,transition:{delay:.6}}},className:"border py-5 rounded-lg w-full border-gray-200 shadow-lg",children:[t.jsx("div",{className:"lg:text-xl md:text-lg text-sm mb-4 text-center",children:"Nitrite - Phosphate - Ammonium (mg/l)"}),t.jsx(g,{width:"100%",height:300,children:t.jsxs(b,{className:"w-full mx-auto",data:S,margin:{top:10,right:50,left:0,bottom:0},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"name"}),t.jsx(m,{}),t.jsx(u,{formatter:o=>N(o)}),t.jsx(j,{onMouseEnter:D,onMouseLeave:C}),t.jsx(f,{type:"monotone",dataKey:"nitrite",strokeOpacity:d.nitrite,stroke:"#8884d8",activeDot:{r:6,fill:"#8884d8",stroke:"white",strokeWidth:2}}),t.jsx(f,{type:"monotone",dataKey:"phosphate",strokeOpacity:d.phosphate,stroke:"#ff7300",activeDot:{r:6,fill:"#ff7300",stroke:"white",strokeWidth:2}}),t.jsx(f,{type:"monotone",dataKey:"totalChlorine",strokeOpacity:d.totalChlorine,stroke:"#387908",activeDot:{r:6,fill:"#387908",stroke:"white",strokeWidth:2}})]})})]}),t.jsxs(l.div,{variants:{hidden:{opacity:0,x:100},visible:{opacity:1,x:0,transition:{delay:.9}}},className:"py-5 rounded-lg border border-gray-200 shadow-lg",children:[t.jsx("div",{className:"lg:text-xl md:text-lg text-sm mb-4 text-center",children:"Carbon - PH - Hardness (dH)"}),t.jsx(g,{width:"100%",height:300,children:t.jsxs(b,{width:500,height:300,data:S,className:"w-full mx-auto",margin:{top:5,right:60},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"name"}),t.jsx(m,{}),t.jsx(u,{formatter:o=>N(o)}),t.jsx(j,{onMouseEnter:D,onMouseLeave:C}),t.jsx(f,{type:"monotone",dataKey:"carbonHardness",strokeOpacity:d.carbonHardness,stroke:"#8884d8",activeDot:{r:6,fill:"#8884d8",stroke:"white",strokeWidth:2}}),t.jsx(f,{type:"monotone",dataKey:"phValue",strokeOpacity:d.phValue,stroke:"#82ca9d",activeDot:{r:6,fill:"#82ca9d",stroke:"white",strokeWidth:2}}),t.jsx(b,{type:"monotone",dataKey:"hardness",strokeOpacity:d.hardness,stroke:"#ff7300",activeDot:{r:6,fill:"#ff7300",stroke:"white",strokeWidth:2}})]})})]}),t.jsxs(l.div,{variants:{hidden:{opacity:0,x:100},visible:{opacity:1,x:0,transition:{delay:1.2}}},className:"py-5 rounded-lg border border-gray-200 shadow-lg",children:[t.jsx("div",{className:"text-xl mb-4 text-center",children:"Temperature - Temp (C)"}),t.jsx(g,{width:"100%",height:300,children:t.jsxs(b,{width:500,height:300,data:S,className:"w-full mx-auto",margin:{top:5,right:60},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"name"}),t.jsx(m,{}),t.jsx(u,{}),t.jsx(j,{onMouseEnter:D,onMouseLeave:C}),t.jsx(f,{type:"monotone",dataKey:"temperature",strokeOpacity:d.temperature,stroke:"#8884d8",activeDot:{r:6,fill:"#8884d8",stroke:"white",strokeWidth:2}}),t.jsx(f,{type:"monotone",dataKey:"temp",strokeOpacity:d.temp,stroke:"#82ca9d",activeDot:{r:6,fill:"#82ca9d",stroke:"white",strokeWidth:2}})]})})]})]}),t.jsxs(l.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.3}}},className:"grid lg:grid-cols-2 grid-cols-1 gap-7 mt-10",children:[t.jsxs(l.div,{variants:{hidden:{opacity:0,x:0},visible:{opacity:1,x:0,transition:{delay:.6}}},className:"py-5 px-2 rounded-lg border border-gray-200 shadow-lg",children:[t.jsx("div",{className:"text-xl mb-4 text-center",children:"CO₂ - O₂ - Total Chlorine (mg/l)"}),t.jsx(g,{width:"100%",height:320,children:t.jsxs(H,{data:S,className:"w-full mx-auto",margin:{top:20,right:30,left:10,bottom:10},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"nitrateColor",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#ff7300",stopOpacity:.6}),t.jsx("stop",{offset:"95%",stopColor:"#ff7300",stopOpacity:0})]}),t.jsxs("linearGradient",{id:"carbonDioxideColor",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#7CF0FF",stopOpacity:.6}),t.jsx("stop",{offset:"95%",stopColor:"#7CF0FF",stopOpacity:0})]}),t.jsxs("linearGradient",{id:"oxygenColor",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#4570EA",stopOpacity:.6}),t.jsx("stop",{offset:"95%",stopColor:"#4570EA",stopOpacity:0})]})]}),t.jsx(x,{strokeDasharray:"3 3",opacity:.3}),t.jsx(p,{dataKey:"name",tick:{fill:"#555"}}),t.jsx(m,{tick:{fill:"#555"}}),t.jsx(u,{formatter:o=>`${N(o)} mg/l`,contentStyle:{backgroundColor:"#f4f4f4",borderColor:"#ddd"},labelStyle:{fontWeight:"bold"}}),t.jsx(y,{type:"monotone",dataKey:"nitrate",stackId:"1",stroke:"#ff7300",fill:"url(#nitrateColor)"}),t.jsx(y,{type:"monotone",dataKey:"carbonDioxide",stackId:"1",stroke:"#7CF0FF",fill:"url(#carbonDioxideColor)"}),t.jsx(y,{type:"monotone",dataKey:"oxygen",stackId:"1",stroke:"#4570EA",fill:"url(#oxygenColor)"})]})})]}),t.jsxs(l.div,{variants:{hidden:{opacity:0,x:0},visible:{opacity:1,x:0,transition:{delay:.9}}},className:"py-5 px-2 rounded-lg border border-gray-200 shadow-lg",children:[t.jsx("div",{className:"text-xl mb-4 text-center",children:"Amount fed (g)"}),t.jsx(g,{width:"100%",height:300,children:t.jsxs(jt,{data:S,children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"name"}),t.jsx(m,{}),t.jsx(u,{}),t.jsx(yt,{dataKey:"amountFed",fill:"#8884d8"})]})})]})]}),t.jsxs(l.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.3}}},className:"grid lg:grid-cols-2 grid-cols-1 gap-7 mt-10",children:[t.jsxs(l.div,{className:"py-5 mt-10 rounded-lg border border-gray-200 shadow-lg",children:[t.jsx("div",{className:"text-xl mb-4 text-center",children:"Koi Length Growth History in Pond"}),t.jsx(g,{width:"100%",height:300,children:t.jsxs(b,{data:ct,className:"w-full mx-auto",margin:{top:5,right:60},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"date"}),t.jsx(m,{}),t.jsx(u,{}),t.jsx(j,{}),B.map((o,a)=>{const e=Math.floor(Math.random()*v.length),s=v[e];return v.splice(e,1),t.jsx(f,{type:"monotone",dataKey:o.koiName,stroke:s,activeDot:{r:8},name:`${o.koiName}`},a)})]})})]}),t.jsxs(l.div,{className:"py-5 mt-10 rounded-lg border border-gray-200 shadow-lg",children:[t.jsx("div",{className:"text-xl mb-4 text-center",children:"Koi Weight Growth History in Pond"}),t.jsx(g,{width:"100%",height:300,children:t.jsxs(b,{data:ht,className:"w-full mx-auto",margin:{top:5,right:60},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"date"}),t.jsx(m,{}),t.jsx(u,{}),t.jsx(j,{}),B.map((o,a)=>{const e=Math.floor(Math.random()*v.length),s=v[e];return v.splice(e,1),t.jsx(f,{type:"monotone",dataKey:o.koiName,stroke:s,activeDot:{r:8},name:`${o.koiName}`},a)})]})})]})]}),t.jsx("div",{className:"pb-6 mt-10 text-lg flex justify-between items-center",children:t.jsxs("select",{id:"kois",className:`${K?"bg-custom-dark":""} border rounded-lg p-2 outline-none`,onChange:ot,children:[t.jsx("option",{value:"",children:"Select a Koi"}),O.length>0?O.map(o=>t.jsx("option",{value:o.id,children:o.name},o.id)):t.jsx("option",{disabled:!0,children:"Loading kois..."})]})}),t.jsxs(l.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.3}}},className:"grid lg:grid-cols-2 grid-cols-1 gap-7",children:[t.jsxs(l.div,{variants:{hidden:{opacity:0,x:-100},visible:{opacity:1,x:0,transition:{delay:1.2}}},className:"border py-5 rounded-lg w-full border-gray-200 shadow-lg",children:[t.jsx("div",{className:"text-xl mb-4 text-center",children:"Length Growth History "}),t.jsx(g,{width:"100%",height:300,children:t.jsxs(H,{data:G,className:"w-full mx-auto",margin:{top:5,right:60},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"name"}),t.jsx(m,{}),t.jsx(u,{formatter:o=>N(o)}),t.jsx(j,{onMouseEnter:D,onMouseLeave:C}),t.jsx(y,{type:"monotone",dataKey:"length",stroke:"#8884d8",fillOpacity:1,fill:"url(#lengthColor)",name:"length"}),t.jsx(y,{type:"monotone",dataKey:"lengthStandard",stroke:"#ff7300",fillOpacity:.6,fill:"url(#lengthStandardColor)",name:"standard length"}),t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"lengthColor",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#8884d8",stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:"#8884d8",stopOpacity:0})]}),t.jsxs("linearGradient",{id:"lengthStandardColor",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#ffc658",stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:"#ffc658",stopOpacity:0})]})]})]})})]}),t.jsxs(l.div,{variants:{hidden:{opacity:0,x:-100},visible:{opacity:1,x:0,transition:{delay:1.5}}},className:"border py-5 rounded-lg w-full border-gray-200 shadow-lg",children:[t.jsx("div",{className:"text-xl mb-4 text-center",children:"Weight Growth History "}),t.jsx(g,{width:"100%",height:300,children:t.jsxs(H,{className:"w-full mx-auto",data:G,margin:{top:5,right:60},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"name"}),t.jsx(m,{}),t.jsx(u,{formatter:o=>N(o)}),t.jsx(j,{onMouseEnter:D,onMouseLeave:C}),t.jsx(y,{type:"monotone",dataKey:"weight",stroke:"#82ca9d",fillOpacity:1,fill:"url(#weightColor)",name:" weight"}),t.jsx(y,{type:"monotone",dataKey:"weightStandard",stroke:"#ff7300",fillOpacity:.6,fill:"url(#weightStandardColor)",name:"standard weight"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"weightStandardColor",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#ff7300",stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:"#ff7300",stopOpacity:0})]})}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"weightColor",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})]})})]})})]})]})]})]})]})})}export{Mt as default};
