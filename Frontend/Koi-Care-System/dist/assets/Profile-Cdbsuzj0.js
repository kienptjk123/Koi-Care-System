import{d as M,r as o,j as e,a as p,B as i}from"./index-CoU4576v.js";import{L as H,H as R}from"./LeftSideBar-C3I9T6Cy.js";import{a as T}from"./index.esm-Cod_m23j.js";/* empty css            */import"./index-DYOF6FZU.js";import"./index-Dsj2DyTX.js";import"./index-BpOwVgMe.js";import"./logo-DG-ZgLhE.js";import"./index-C6U7UJyo.js";import"./Popover-D3I8Bna5.js";import"./createSimplePaletteValueFilter-BkuHQHCT.js";import"./Transition-R9nnOErc.js";import"./Typography-7IhSei9U.js";function se(){const{isDarkMode:a}=M(),[w,I]=o.useState([]),[r,g]=o.useState(!1),[c,f]=o.useState(!1),[j,F]=o.useState(null),[n,v]=o.useState(null),[N,k]=o.useState(""),[u,y]=o.useState(""),[h,P]=o.useState(""),[m,S]=o.useState(!1),{register:d,handleSubmit:B,reset:$,formState:{errors:C}}=T(),D=async()=>{try{const t=localStorage.getItem("token"),l=localStorage.getItem("id");if(!t)throw new Error("No token found");const s=(await p.get(`https://koicaresystemv2.azurewebsites.net/api/profile/${l}`,{headers:{Authorization:`Bearer ${t}`}})).data.data;Object.keys(s).forEach(x=>{s[x]===null&&(s[x]="")}),I(s),v(s.avatar),$(s)}catch(t){console.error("Error fetching users:",t)}},O=async t=>{f(!0);try{const l=localStorage.getItem("token"),E=localStorage.getItem("id");if(!l)throw new Error("No token found");const s=new FormData;s.append("name",t.name),s.append("email",t.email),s.append("phone",t.phone),s.append("gender",t.gender),s.append("bio",t.bio),s.append("address",t.address),s.append("dateOfBirth",t.dateOfBirth),j&&s.append("file",j);const x=await p.put(`https://koicaresystemv2.azurewebsites.net/api/profile/update/${E}`,s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});i.success("Profile updated successfully!"),g(!1),D()}catch(l){console.error("Error updating user:",l),i.error("Failed to update profile.")}finally{f(!1)}},A=async()=>{if(u!==h){i.error("Passwords do not match!");return}try{const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const l=await p.patch("https://koicaresystemv2.azurewebsites.net/api/users/changePassword",{currentPassword:N,newPassword:u,confirmationPassword:h},{headers:{Authorization:`Bearer ${t}`}});i.success("Password changed successfully!"),k(""),y(""),P(""),S(!1)}catch(t){console.error("Error changing password:",t),i.error("Failed to change password.")}},z=t=>{const l=t.target.files[0];F(l),l&&v(URL.createObjectURL(l))},U=t=>{O(t)};o.useEffect(()=>{D()},[]),new Date().toISOString().split("T")[0];const b=new Date;b.setFullYear(b.getFullYear()-15);const L=b.toISOString().split("T")[0];return e.jsx("div",{children:e.jsxs("div",{className:"h-screen flex",children:[e.jsx(H,{}),e.jsxs("div",{className:`relative ${a?"bg-custom-dark text-white":"bg-white text-black"} shadow-xl flex-1 flex-col overflow-y-auto overflow-x-hidden duration-200 ease-linear`,children:[e.jsx(R,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"gap-8 p-4 flex justify-center items-center flex-col  ",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Profile Information"}),e.jsxs("form",{onSubmit:B(U),className:"mt-4 w-2/3 ",children:[e.jsxs("div",{className:"grid grid-cols-3",children:[e.jsx("div",{className:"flex items-center justify-center h-full pr-20 ",children:r?e.jsxs("div",{className:"flex flex-col items-center col-span-1",children:[e.jsx("input",{type:"file",onChange:z,className:"border rounded p-2 mb-2 border-blue-500"}),n&&e.jsx("div",{className:"relative w-60 h-60",children:e.jsx("img",{src:n,alt:"Avatar Preview",className:"object-cover w-full h-full rounded-full border-2 border-gray-300 shadow-lg"})})]}):n&&e.jsx("div",{className:"relative w-60 h-60",children:e.jsx("img",{src:n,alt:"Avatar",className:"object-cover w-full h-full rounded-full border-2 border-gray-300 shadow-lg"})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 col-span-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Name:"}),e.jsx("input",{type:"text",...d("name"),disabled:!0,className:`border rounded p-2 w-full  cursor-not-allowed ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Email:"}),e.jsx("input",{type:"text",...d("email"),disabled:!0,className:`border rounded p-2 w-full  cursor-not-allowed ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Phone:"}),e.jsx("input",{type:"text",...d("phone",{pattern:{value:/(03|07|08|09|01[2|6|8|9])+([0-9]{8})\b/,message:"Invalid phone number format"}}),disabled:!r,className:`border rounded p-2 w-full ${r?"border":"bg-white"}, ${a?"bg-custom-dark text-white":"bg-white text-black"}`}),C.phone&&e.jsx("span",{className:"text-red-500",children:C.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Gender:"}),e.jsxs("select",{...d("gender"),disabled:!r,className:`border rounded p-2 w-full ${r?"border":"bg-white"}, ${a?"bg-custom-dark text-white":"bg-white text-black"}
                        `,children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Date of Birth:"}),e.jsx("input",{type:"date",...d("dateOfBirth"),disabled:!r,max:L,className:`border rounded p-2 w-full ${r?"border":"bg-white"}, ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Created Date:"}),e.jsx("input",{type:"text",value:new Date(w.createdDate).toLocaleDateString(),disabled:!0,className:`border rounded p-2 w-full  cursor-not-allowed ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Address:"}),e.jsx("input",{type:"text",...d("address"),disabled:!r,className:`border rounded p-2 w-full ${r?"border":"bg-white"}, ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Bio:"}),e.jsx("textarea",{...d("bio"),disabled:!r,className:`border rounded p-2 w-full ${r?"border":"bg-white"}, ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{g(!r),r||$(w)},className:"bg-blue-500 text-white p-2 rounded mr-2 w-20",children:r?"Cancel":"Edit"}),r&&e.jsx("button",{type:"submit",className:`px-4 py-2 bg-green-500 text-white rounded-md ${c?"opacity-50 cursor-not-allowed":"hover:bg-blue-700"}`,disabled:c,children:c?"Submitting...":"Update Profile"}),e.jsx("button",{type:"button",onClick:()=>S(!m),className:"bg-yellow-500 text-white p-2 rounded ml-2 w-70",children:m?"Hide Password Form":"Change Password"})]})]})]}),e.jsx("div",{className:"gap-4 p-4 flex justify-center items-center flex-col",children:m&&e.jsxs("div",{className:"w-2/3 mt-4 border rounded p-4 shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Change Password"}),e.jsxs("div",{className:" gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Current Password:"}),e.jsx("input",{type:"password",value:N,onChange:t=>k(t.target.value),className:`border rounded p-2 w-full ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"New Password:"}),e.jsx("input",{type:"password",value:u,onChange:t=>y(t.target.value),className:`border rounded p-2 w-full ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Confirm New Password:"}),e.jsx("input",{type:"password",value:h,onChange:t=>P(t.target.value),className:`border rounded p-2 w-full ${a?"bg-custom-dark text-white":"bg-white text-black"}`})]})]}),e.jsx("button",{type:"button",onClick:A,className:"mt-4 px-4 py-2 bg-green-500 text-white rounded-md",children:"Change Password"})]})})]})]})]})})}export{se as default};
