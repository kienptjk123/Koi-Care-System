import{e as T,d as $,u as I,r as l,j as t,a as u,B as p}from"./index-CoU4576v.js";import{L as z,H as A}from"./LeftSideBar-CgWCGgBa.js";import{T as L}from"./TopLayoutShop-Co4L0DWg.js";import{a as q}from"./index.esm-Cod_m23j.js";import{S as M}from"./react-select.esm-DYgUnYX9.js";import{i as U}from"./react-select-animated.esm-BCkWciO_.js";import{R}from"./quill.snow-BLxkI2si.js";/* empty css            */import"./logo-DG-ZgLhE.js";import"./index-BKt2-fzg.js";import"./index-Dsj2DyTX.js";import"./index-DYOF6FZU.js";import"./Transition-R9nnOErc.js";import"./toPropertyKey-BWR5Sd7u.js";import"./isEqual-D335OppD.js";const V=U();function le(){const{id:d}=T(),{isDarkMode:o}=$(),w=I(),[c,h]=l.useState(!1),[H,m]=l.useState(!0),[O,k]=l.useState(null),[N,j]=l.useState([]),[g,x]=l.useState([]),[F,f]=l.useState(""),{register:b,handleSubmit:y,formState:{errors:a},reset:v}=q(),D=async()=>{try{const e=localStorage.getItem("token");if(!e)throw new Error("No token found");const s=await u.get(`https://koicaresystemv2.azurewebsites.net/api/blog/getID/${d}`,{headers:{Authorization:`Bearer ${e}`}});k(s.data.data),v(s.data.data),x(s.data.data.tags.map(r=>({value:r.tagId,label:r.tagName}))),f(s.data.data.blogContent)}catch(e){console.error("Error fetching blog:",e),p.error("Failed to fetch blog details.")}finally{m(!1)}};l.useEffect(()=>{D()},[d]);const S=async()=>{try{const e=localStorage.getItem("token");if(!e)throw new Error("No token found");const s=await u.get("https://koicaresystemv2.azurewebsites.net/api/tag",{headers:{Authorization:`Bearer ${e}`}});j(s.data.data.map(r=>({value:r.tagId,label:r.tagName})))}catch(e){console.log("Error fetching tags:",e)}};l.useEffect(()=>{S()},[]);const B=async e=>{var s,r;m(!0),h(!0);try{const n=localStorage.getItem("token");if(!n)throw new Error("No token found");const i=new FormData;i.append("blogTitle",e.blogTitle),i.append("blogContent",F),i.append("blogDate",e.blogDate),g.forEach(E=>{i.append("tagIds",E.value)}),e.file&&e.file.length>0&&i.append("file",e.file[0]);const P=await u.put(`https://koicaresystemv2.azurewebsites.net/api/blog/update/${d}`,i,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${n}`}});p.success("Blog updated successfully!"),w("/shop/shopNews")}catch(n){console.log(n),p.error(((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to update blog.")}finally{h(!1),m(!1)}},C=e=>{B(e)};return t.jsxs("div",{className:"h-screen flex",children:[t.jsx(z,{}),t.jsxs("div",{className:`relative ${o?"bg-custom-light text-white":"bg-white text-black"} flex-1 flex-col overflow-y-auto overflow-x-hidden`,children:[t.jsx(A,{}),t.jsxs("div",{className:"py-5 pb-10 px-[30px] mx-auto",children:[t.jsx(L,{text:"News",textName:"Update News",links:"shop/shopNews"}),t.jsx("div",{className:" p-6 rounded-md border",children:t.jsxs("form",{onSubmit:y(C),className:"mt-5 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"blogTitle",className:"block text-sm font-bold mb-2",children:"Blog Title"}),t.jsx("input",{type:"text",id:"blogTitle",...b("blogTitle",{required:"Blog title is required"}),className:`w-full p-2 border rounded-md ${o?"bg-custom-dark text-white":"bg-white text-black"} ${a.blogTitle?"border-red-500":"border-gray-300"}`}),a.blogTitle&&t.jsx("p",{className:"text-red-500 text-sm",children:a.blogTitle.message})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold mb-2",children:"Select Tags"}),t.jsx(M,{isMulti:!0,options:N,value:g,onChange:x,closeMenuOnSelect:!1,components:V,styles:{control:(e,s)=>({...e,backgroundColor:o?"#1F2937":"#FFFFFF",color:o?"#FFFFFF":"#000000",borderColor:a.tags?"#EF4444":"#D1D5DB","&:hover":{borderColor:a.tags?"#EF4444":"#9CA3AF"}}),menu:e=>({...e,backgroundColor:o?"#1F2937":"#FFFFFF"}),option:(e,s)=>({...e,backgroundColor:s.isFocused?o?"#374151":"#E5E7EB":o?"#1F2937":"#FFFFFF",color:o?"#FFFFFF":"#000000"}),multiValue:e=>({...e,backgroundColor:o?"#4B5563":"#E5E7EB",color:o?"#FFFFFF":"#000000"}),multiValueLabel:e=>({...e,color:o?"#FFFFFF":"#000000"}),multiValueRemove:e=>({...e,color:o?"#FFFFFF":"#000000",":hover":{backgroundColor:o?"#374151":"#D1D5DB",color:o?"#F87171":"#EF4444"}})}}),g.length===0&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:"At least one tag is required"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"blogContent",className:"block text-sm font-bold mb-2",children:"Blog Content"}),t.jsx(R,{value:F,onChange:f,theme:"snow",className:`w-full  rounded-md ${o?"bg-custom-dark text-white":"bg-white text-black"} ${a.blogContent?"border-red-500":"border-gray-300"}`,modules:{toolbar:[[{header:"1"},{header:"2"},{font:[]},{size:[]}],[{list:"ordered"}],["bold","italic","underline"],[{align:[]}],["link"]]}}),a.blogContent&&t.jsx("p",{className:"text-red-500 text-sm",children:a.blogContent.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"blogDate",className:"block text-sm font-bold",children:"Blog Date"}),t.jsx("input",{type:"date",id:"blogDate",...b("blogDate",{required:"Blog date is required"}),className:`w-full p-2 border rounded-md ${o?"bg-custom-dark text-white":"bg-white text-black"} ${a.blogDate?"border-red-500":"border-gray-300"}`}),a.blogDate&&t.jsx("p",{className:"text-red-500 text-sm",children:a.blogDate.message})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"file",className:"block text-sm font-bold mb-2",children:"Upload Blog Image File"}),t.jsx("input",{type:"file",id:"file",accept:"image/*",className:`w-full p-2 border rounded-md ${o?"bg-custom-dark text-white":"bg-white text-black"} ${a.file?"border-red-500":"border-gray-300"}`,...b("file")}),a.file&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.file.message})]}),t.jsx("button",{type:"submit",className:`px-4 py-2 bg-blue-600 text-white rounded-md ${c?"opacity-50 cursor-not-allowed":"hover:bg-blue-700"}`,disabled:c,children:c?"Updating...":"Update Blog"})]})})]})]})]})}export{le as default};
