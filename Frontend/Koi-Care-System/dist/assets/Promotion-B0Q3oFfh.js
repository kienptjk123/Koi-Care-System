import{d as I,r as i,u as M,j as e,a as d,B as c}from"./index-CfTJQyAl.js";import{L as F,H as R}from"./LeftSideBar--WBJwuap.js";import{T}from"./TopLayoutShop-CL17n5Zb.js";import{t as G,w as A,x as O,i as H,y as L,z as _}from"./index-I2PFEF8e.js";import{B as N,G as Y}from"./index-CQlXHc9i.js";import{b as W}from"./index-CMCoKFFx.js";import{u as m,w as J}from"./xlsx-DjuO7_Ju.js";import{S as U}from"./sweetalert2.esm.all-D3pEHXw3.js";import{P as q}from"./Popover-dzxKlUDl.js";import{D as K}from"./DataGrid-B07rY0S9.js";import"./index-Cwoo4zCl.js";import"./index-B1zBnQXA.js";/* empty css            */import"./logo-DG-ZgLhE.js";import"./createSimplePaletteValueFilter-D-6_72BM.js";import"./Transition-DBChHCkG.js";import"./index-DqVkHg8o.js";import"./toPropertyKey-DPOzxoq6.js";import"./TextField-CBhVO6uG.js";import"./useFormControl-8kqCIbcp.js";import"./SwitchBase-De2nyN10.js";import"./Typography-DYzreIeS.js";import"./InputAdornment-BqFIYZHk.js";function Ne(){const{isDarkMode:n}=I(),[u,j]=i.useState([]),[o,x]=i.useState(null),[y,h]=i.useState(!1),[p,l]=i.useState([]),[Q,f]=i.useState(!0),b=M(),a=t=>{const s=new Date(t),r=String(s.getDate()).padStart(2,"0"),P=String(s.getMonth()+1).padStart(2,"0"),C=s.getFullYear(),$=String(s.getHours()).padStart(2,"0"),z=String(s.getMinutes()).padStart(2,"0"),B=String(s.getSeconds()).padStart(2,"0");return`${$}:${z}:${B} ${r}/${P}/${C}`},g=t=>{x(t),h(!0),D(t.id)},v=()=>{h(!1),x(null),l([])},w=async()=>{try{const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const s=await d.get("https://koicaresystemv2.azurewebsites.net/api/promotions/all",{headers:{Authorization:`Bearer ${t}`}});j(s.data.data)}catch(t){console.log("Error fetching promotions:",t)}};i.useEffect(()=>{w()},[]);const D=async t=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("No token found");const r=await d.get(`https://koicaresystemv2.azurewebsites.net/api/promotions/${t}/products/view`,{headers:{Authorization:`Bearer ${s}`}});console.log("Product details response:",r.data),r.data&&r.data.data?l(r.data.data):l([])}catch(s){console.log("Error fetching product details:",s),l([])}},S=async t=>{const{isConfirmed:s}=await U.fire({title:"Are you sure?",text:"You wonâ€™t be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"});if(s){f(!0);try{const r=localStorage.getItem("token");if(!r)throw new Error("No token found");await d.delete(`https://koicaresystemv2.azurewebsites.net/api/promotions/promotion/${t}/delete`,{headers:{Authorization:`Bearer ${r}`}}),c.success("Promotion deleted successfully"),w()}catch(r){c.error("Error deleting promotion"),console.error("Error deleting promotion:",r)}finally{f(!1)}}},k=[{field:"name",headerName:"Name",width:150},{field:"startDate",headerName:"Start Date",width:170,renderCell:t=>a(t.row.startDate)},{field:"endDate",headerName:"End Date",width:170,renderCell:t=>a(t.row.endDate)},{field:"discountRate",headerName:"Discount Rate",width:120},{field:"description",headerName:"Description",flex:1},{field:"status",headerName:"Status",width:150,renderCell:t=>{const s=t.value;let r="border-2 text-sm font-medium py-1 px-2 rounded text-center";switch(s){case"PENDING":r+=" border-yellow-500 text-yellow-500";break;case"PROCESSING":r+=" border-blue-500 text-blue-500";break;case"ACCEPTED":r+=" border-green-500 text-green-500";break;case"REJECTED":r+=" border-red-500 text-red-500";break;default:r+=" border-gray-500 text-gray-500"}return e.jsx("div",{className:"h-full flex justify-start items-center",children:e.jsx("div",{className:r,children:s})})}},{field:"products",headerName:"Products",width:100,renderCell:t=>e.jsx("div",{className:"flex h-full justify-start items-center",children:e.jsx("button",{className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded-full",onClick:()=>g(t.row),children:e.jsx(O,{className:"size-5"})})})},{field:"action",headerName:"Action",width:130,renderCell:t=>e.jsxs("div",{className:"flex h-full justify-start items-center",children:[e.jsx("button",{className:"p-1 text-green-500 hover:bg-green-500 hover:text-white rounded-full",onClick:()=>g(t.row),children:e.jsx(H,{className:"size-5"})}),e.jsx("button",{className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded-full mx-2",onClick:()=>{t.row.status==="PENDING"?b(`/shop/promotion/${t.row.id}`):c.warning("You can only edit promotions in PENDING status")},children:e.jsx(L,{className:"size-5"})}),e.jsx("button",{className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded-full",onClick:()=>S(t.row.id),children:e.jsx(_,{className:"size-5"})})]})}],E=()=>{const t=m.json_to_sheet(u.map(r=>({Name:r.name,"Start Date":a(r.startDate),"End Date":a(r.endDate),"Discount Rate":r.discountRate,Status:r.status,Description:r.description}))),s=m.book_new();m.book_append_sheet(s,t,"Promotions"),J(s,"Promotions.xlsx")};return e.jsxs("div",{className:"h-screen flex",children:[e.jsx(F,{}),e.jsxs("div",{className:`relative ${n?"bg-custom-light text-white":"bg-white text-black"} flex-1 overflow-y-auto`,children:[e.jsx(R,{}),e.jsxs("div",{className:"py-5 px-[30px] max-w-[1750px] mx-auto",children:[e.jsx(T,{text:"Promotions"}),e.jsxs("div",{className:"w-full flex justify-between items-center relative mb-4",children:[e.jsx("div",{className:"cursor-pointer",children:e.jsx("button",{className:"py-2 px-3 bg-custom-left-bar text-white hover:bg-blue-600 rounded-md",onClick:()=>b("/shop/createPromotion"),children:"New Promotion"})}),e.jsx("div",{className:"cursor-pointer",children:e.jsx("button",{onClick:E,className:"py-2 px-3 bg-blue-500 text-white hover:bg-blue-700 rounded-md",children:"Download Excel"})})]}),e.jsx(q,{sx:{height:670},children:e.jsx(K,{rows:u,columns:k,checkboxSelection:!0,disableExtendRowFullWidth:!0,pageSizeOptions:[5,10,20,50,100],pageSize:10,rowHeight:80,sx:{"& .MuiDataGrid-columnHeaders":{backgroundColor:n?"#333":"#f5f5f5"},"& .MuiDataGrid-row:hover":{backgroundColor:n?"rgb(36 48 63 / var(--tw-bg-opacity))":"#e0e0e0"}}})}),y&&o&&e.jsx("div",{className:`fixed top-0 left-0 overflow-auto w-full h-full flex justify-center items-center z-50 bg-opacity-50 ${n?"bg-gray-900 text-gray-200":"bg-gray-800 text-gray-600"}`,children:e.jsxs("div",{className:`p-4 border rounded-lg max-h-[80vh] max-w-[100vw] w-[80vh] overflow-auto ${n?"bg-gray-800 border-gray-700":"bg-white"}`,children:[e.jsx("h3",{className:"text-xl text-center font-bold mb-4",children:"PROMOTION DETAILS"}),e.jsxs("div",{children:[e.jsxs("div",{className:" p-4 border rounded-lg shadow-lg",children:[e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(G,{})," Name: ",o.name]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(N,{})," Start Date: ",a(o.startDate)]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(N,{})," End Date: ",a(o.endDate)]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(A,{})," Discount Rate: ",o.discountRate,"%"]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(Y,{})," Description: ",o.description]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(W,{})," Status: ",o.status]})]}),e.jsxs("div",{className:"Order-Table overflow-auto p-4 mt-4 shadow-lg border rounded-lg",style:{maxHeight:"300px"},children:[e.jsx("h4",{className:"text-lg font-bold text-left ",children:"Product Details"}),p.length>0?e.jsxs("table",{className:"min-w-full border-spacing-x-1 border-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 text-center text-xs font-bold uppercase",children:"No"})," ",e.jsx("th",{className:"py-3 px-4 text-center text-xs font-bold uppercase",children:"Product Name"})]})}),e.jsx("tbody",{children:p.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-1 text-center border-b border-gray-200",children:s+1})," ",e.jsx("td",{className:"py-2 px-1 text-center border-b border-gray-200",children:t.name})]},s))})]}):e.jsx("p",{children:"No products available for this promotion."})]})]}),e.jsx("button",{onClick:v,className:"bg-red-500 text-white rounded p-2 mt-4",children:"Close"})]})})]})]})]})}export{Ne as default};
