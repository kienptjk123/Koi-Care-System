import{d as F,r as o,u as G,j as e,P as A,a as m,B as d}from"./index-DsR5MBtH.js";import{L as B,H as O}from"./LeftSideBar-CY7waHD-.js";import{T as H}from"./TopLayoutAD-DYY3_eZW.js";import{t as L,w as _,x as J}from"./index-gO7psG0g.js";import{B as N,G as U}from"./index-D-eG03hQ.js";import{b as W}from"./index-B5ip7E7x.js";import{u,w as Y}from"./xlsx-DjuO7_Ju.js";import{D as q}from"./DataGrid-ChJUn34g.js";import"./index-BMqfeWhp.js";/* empty css            */import"./logo-DG-ZgLhE.js";import"./index-BKN4LrXa.js";import"./toPropertyKey-PLuKRk1e.js";import"./Typography-BGxL3EC8.js";import"./SwitchBase-C3VyX5I_.js";import"./InputAdornment-D4oGorCC.js";function xe(){const{isDarkMode:i}=F(),[x,D]=o.useState([]),[a,h]=o.useState(null),[K,p]=o.useState(!0),[Q,g]=o.useState(!1),[f,l]=o.useState([]),[y,b]=o.useState(!1),w=G(),n=s=>{const t=new Date(s),r=String(t.getDate()).padStart(2,"0"),c=String(t.getMonth()+1).padStart(2,"0"),R=t.getFullYear(),T=String(t.getHours()).padStart(2,"0"),M=String(t.getMinutes()).padStart(2,"0"),z=String(t.getSeconds()).padStart(2,"0");return`${T}:${M}:${z} ${r}/${c}/${R}`},v=s=>{h(s),b(!0),E(s.id)},S=()=>{b(!1),h(null),l([])},j=async()=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("No token found");const t=await m.get("https://koicaresystemv2.azurewebsites.net/api/promotions/all",{headers:{Authorization:`Bearer ${s}`}});D(t.data.data)}catch(s){console.log("Error fetching promotions:",s)}};o.useEffect(()=>{j()},[]);const E=async s=>{try{const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const r=await m.get(`https://koicaresystemv2.azurewebsites.net/api/promotions/${s}/products/view`,{headers:{Authorization:`Bearer ${t}`}});console.log("Product details response:",r.data),r.data&&r.data.data?l(r.data.data):l([])}catch(t){console.log("Error fetching product details:",t),l([])}},P=async s=>{p(!0),g(!0);try{const t=localStorage.getItem("token");if(!t){d.error("You need to log in first."),w("/login");return}if(!s.id)throw new Error("Promotion ID not found");const r=await m.put("https://koicaresystemv2.azurewebsites.net/api/promotions/promotion/confirm",{promotionId:s.id,status:s.status},{headers:{Authorization:`Bearer ${t}`}});d.success("Promotion updated successfully!"),j(),w("/admin/promotion")}catch(t){console.error("Error updating promotion:",t),t.response&&t.response.data?d.error(`Failed to update Promotion: ${t.response.data.message||"Unknown error"}`):d.error("Failed to update Promotion. Please try again.")}finally{g(!1),p(!1)}},k=s=>{P(s)},C=(s,t)=>{const r={...s,status:t};k(r)},I=[{field:"name",headerName:"Name",width:150},{field:"startDate",headerName:"Start Date",width:170,renderCell:s=>n(s.row.startDate)},{field:"endDate",headerName:"End Date",width:170,renderCell:s=>n(s.row.endDate)},{field:"discountRate",headerName:"Discount Rate",width:120},{field:"description",headerName:"Description",flex:1},{field:"products",headerName:"Products",width:100,renderCell:s=>e.jsx("div",{className:"flex h-full justify-start items-center",children:e.jsx("button",{className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded-full",onClick:()=>v(s.row),children:e.jsx(J,{className:"size-5"})})})},{field:"status",headerName:"Status",width:150,renderCell:s=>{const t=s.row;let r="border-2 text-sm font-medium py-1 px-2 rounded text-center";switch(t.status){case"PENDING":r+=" border-yellow-500 text-yellow-500";break;case"PROCESSING":r+=" border-blue-500 text-blue-500";break;case"ACCEPTED":r+=" border-green-500 text-green-500";break;case"REJECTED":r+=" border-red-500 text-red-500";break;default:r+=" border-gray-500 text-gray-500"}return e.jsx("div",{className:"flex justify-center items-center h-full",children:t.status==="PENDING"?e.jsxs("select",{className:`${r} bg-white border border-gray-300 rounded px-2 py-1`,value:t.status,onChange:c=>C(t,c.target.value),children:[e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"ACCEPTED",children:"ACCEPTED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"})]}):e.jsx("div",{className:r,children:t.status})})}}],$=()=>{const s=u.json_to_sheet(x.map(r=>({Name:r.name,"Start Date":n(r.startDate),"End Date":n(r.endDate),"Discount Rate":r.discountRate,Status:r.status,Description:r.description}))),t=u.book_new();u.book_append_sheet(t,s,"Promotions"),Y(t,"Promotions.xlsx")};return e.jsx("div",{children:e.jsxs("div",{className:"h-screen flex",children:[e.jsx(B,{}),e.jsxs("div",{className:`relative ${i?"bg-custom-light text-white":"bg-white text-black"} overflow-y-auto flex-1 flex-col overflow-x-hidden duration-200 ease-linear`,children:[e.jsx(O,{}),e.jsxs("div",{className:"py-5 px-[30px] max-w-[1750px] mx-auto",children:[e.jsx(H,{text:"Promotion"}),e.jsx("div",{className:"w-full flex justify-between items-center relative mb-4",children:e.jsx("div",{className:"cursor-pointer",children:e.jsx("button",{onClick:$,className:"mb-4 ml-3 p-2 bg-blue-500 text-white hover:bg-blue-700 rounded-md",children:"Download Excel"})})}),e.jsx(A,{sx:{height:670},children:e.jsx(q,{rows:x,columns:I,checkboxSelection:!0,disableExtendRowFullWidth:!0,pageSizeOptions:[5,10,20,50,100],pageSize:10,rowHeight:80,sx:{"& .MuiDataGrid-columnHeaders":{backgroundColor:i?"#333":"#f5f5f5"},"& .MuiDataGrid-row:hover":{backgroundColor:i?"rgb(36 48 63 / var(--tw-bg-opacity))":"#e0e0e0"}}})}),y&&a&&e.jsx("div",{className:`fixed top-0 left-0 overflow-auto w-full h-full flex justify-center items-center z-50 bg-opacity-50 ${i?"bg-gray-900 text-gray-200":"bg-gray-800 text-gray-600"}`,children:e.jsxs("div",{className:`p-4 border rounded-lg max-h-[80vh] max-w-[100vw] w-[80vh] overflow-auto ${i?"bg-gray-800 border-gray-700":"bg-white"}`,children:[e.jsx("h3",{className:"text-xl text-center font-bold mb-4",children:"PROMOTION DETAILS"}),e.jsxs("div",{children:[e.jsxs("div",{className:" p-4 border rounded-lg shadow-lg",children:[e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(L,{})," Name: ",a.name]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(N,{})," Start Date: ",n(a.startDate)]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(N,{})," End Date: ",n(a.endDate)]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(_,{})," Discount Rate: ",a.discountRate,"%"]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(U,{})," Description: ",a.description]}),e.jsxs("p",{className:"mb-3 flex items-center gap-2",children:[e.jsx(W,{})," Status: ",a.status]})]}),e.jsxs("div",{className:"Order-Table overflow-auto p-4 mt-4 shadow-lg border rounded-lg",style:{maxHeight:"300px"},children:[e.jsx("h4",{className:"text-lg font-bold text-left ",children:"Product Details"}),f.length>0?e.jsxs("table",{className:"min-w-full border-spacing-x-1 border-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 text-center text-xs font-bold uppercase",children:"No"})," ",e.jsx("th",{className:"py-3 px-4 text-center text-xs font-bold uppercase",children:"Product Name"})]})}),e.jsx("tbody",{children:f.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-1 text-center border-b border-gray-200",children:t+1})," ",e.jsx("td",{className:"py-2 px-1 text-center border-b border-gray-200",children:s.name})]},t))})]}):e.jsx("p",{children:"No products available for this promotion."})]})]}),e.jsx("button",{onClick:S,className:"bg-red-500 text-white rounded p-2 mt-4",children:"Close"})]})})]})]})]})})}export{xe as default};
